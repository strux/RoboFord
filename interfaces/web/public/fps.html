<!DOCTYPE html>
<html>
	<head>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js" type="text/javascript"></script>
	</head>
	<body>
		<script type="text/javascript">
		
			var validKeys = ["W", "A", "S", "D"],
					downKeyMap = {
						W: 'f', // forward
						A: 'l', // left
						S: 'b', // back
						D: 'r'  // right
					},
					upKeyMap = {
						W: 's', // stop
						A: 'c', // center
						S: 's', // stop
						D: 'c'  // center
					},
					downKeys = [],
					validKeyCodes = [];
			for(var key in validKeys){
				var code = validKeys[key].charCodeAt();
				validKeyCodes.push(code);
			}

			$(document).ready(function(){
				$(document).keydown(function(event) {
					if($.inArray(event.keyCode, validKeyCodes) > -1 && $.inArray(event.keyCode, downKeys) == -1){
						var chr = String.fromCharCode(event.keyCode);
						console.log(event.type + ": " + chr);
						downKeys.push(event.keyCode);
						console.log(downKeys);
						$.ajax({
							url: 'http://localhost:4567',
							data: { command: downKeyMap[chr]}
						})
					}							
		    });
				$(document).keyup(function(event) {
					if($.inArray(event.keyCode, validKeyCodes) > -1 && $.inArray(event.keyCode, downKeys) > -1){
						var chr = String.fromCharCode(event.keyCode);
						console.log(event.type + ": " + chr);
						downKeys.splice($.inArray(event.keyCode, downKeys), 1);
						console.log(downKeys);
						$.ajax({
							url: 'http://localhost:4567',
							data: { command: upKeyMap[chr]}
						})
					}							
		    });
			})

		</script>
	</body>
</html>
